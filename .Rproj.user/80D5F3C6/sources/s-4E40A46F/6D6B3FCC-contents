library(here)
library(readstata13)
library(tidyverse)
library(rstan)
library(survival)

## Data ====
KK20 = read.dta13(here('data/Krauss2020_WomenCabinet.dta'))
KK20$decade = as.factor(KK20$decade)
KK20$ciep = as.factor(KK20$ciep)
KK20$maxdur = scale(KK20$maxdur)
KK20$share_women_executive = KK20$share_women_executive / 100

# Stan Data
event = KK20$failure
T_event = KK20$duration[event]
T_censor = KK20$duration[!event]
X = model.matrix(~ -1 + share_women_executive + pref + enpp + 
                   decade + ciep + minority + maxdur, 
                 data = KK20)
#X = model.matrix(~ -1 + minority, 
#                 data = KK20)
p = ncol(X)
X_event = matrix(X[event,], ncol = p)
X_censor = matrix(X[!event,], ncol = p)  
n_event = nrow(X_event)
n_censor = nrow(X_censor)

KK20.stan_vector = list(n_event = n_event, n_censor = n_censor, p = p,
                        X_event = X_event, X_censor = X_censor,
                        T_event = T_event, T_censor = T_censor)
KK20.stan_lower = KK20.stan_vector 
names(KK20.stan_lower)[names(KK20.stan_lower) == "T_censor"] = "lower_censor"

# run models
fit.exp_vector = stan(here("stanmodels", "survexp_vector.stan"),
                      data = KK20.stan_vector, cores = 4)
fit.exp_vector
fit.exp_lower = stan(here("stanmodels", "survexp_lower.stan"),
                      data = KK20.stan_lower, cores = 4)
fit.exp_lower

echo "# BaysianStats_FinalProject" >> README.md
git init
git add README.md
git commit -m "first commit"
git branch -M main
git remote add origin https://github.com/pitrieger/BaysianStats_FinalProject.git
git push -u origin main
